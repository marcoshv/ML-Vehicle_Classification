# Vehicle Classification assignment
## Introduction
    In sprint project 5 a computer vision model had to be trained, in this case we had to finish the python scripts to make the model work and run it inside a docker container. The scripts were tested before starting training, once the test passed all the files were pushed to a GitHub repository and pulled from the server to start training. Three experiments with different settings were run in the server, the notebook 'Model Evaluation' was used to test the training model using the weights of the third experiment, which pass the minimum accuracy test stablished by the instructors.

## Hardware AWS cloud server
    Processor: -
    GPU : Nvidia Tesla - K80 RAM: 12.0 GB 
    OS: Ubuntu

## Tests
    test_data_aug.py --> PASSED
    test_detection.py --> PASSED
    test_resnet_50.py --> PASSED
    test_utils.py --> PASSED

## Trainings
Bellow are shown the model parameter of each test, more parameter can be foung in the experiment1.yml, experiment2.yml and experiment3.yml files.

                  Weights        Dropout rate        Random flip           Random rotation    Random_Zoom hight    Random_Zoom hight width    Optimizer     learning rate     
    Test 1 -      imagenet            0.5        horizontal_and_vertical         0.5          height_factor:0.5        width_factor:0.5         adam           0.0001
    Test 2 - model.186-3.2971.h5      0.5        horizontal_and_vertical         0.5          height_factor:0.5        width_factor:0.5         adam           0.00001
    Test 3 - model.44-1.8209.h5       0.55       horizontal_and_vertical         0.5          height_factor:0.5        width_factor:0.5         adam           0.00001

                        Loss               Metrics        Classes     Epochs        Train accuracy      Validation accuracy     
    Test 1 -   categorical_crossentropy    accuracy        196          186             0.3659                 0.2684            
    Test 2 -   categorical_crossentropy    accuracy        196           44             0.895                  0.5732
    Test 3 -   categorical_crossentropy    accuracy        196           58             0.966                  0.6963
    
## Final comments
    First experiment: The CNN Resnet50 model was loaded with the 'imagenet' weights (transfer learning), and our custom dataset (vehicle pictures) returning a model ready for performing finetuning.

    Second experiment: After that, the model was loaded with the weights that resulted from our first experiment and trained (finetuning), getting better results in terms of training and validation accuracy.

    Third experiment: Before running the third experiment the pictures were cropped using the coordinates generated by detectron, isolating the car from the background, using the detection.py and remove_background.py scripts, a new dataset (cropped vehicle pictures) was created with the cropped images. Finally, the model was trained using the weights of the second experiment and the new dataset (cropped vehicle pictures), removing noisy background improved our training and validation accuracy.

    In the last step, the model was evaluated using the 'Model Evaluation' notebook, getting a model accuracy of 0.6222.

    As the finetuning tends to overfit, trying different dropout values and regularizers its especially important to keep the model from overfitting too much, trying various data augmentation parameters is also very important for the model to learn to make better predictions, removing the background from the images was a great strategy to improve the model accuracy. 
    
    Decreasing learning rate gave better results as well as increasing training epochs.
